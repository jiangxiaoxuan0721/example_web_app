# Agent Programmable UI Runtime

åŸºäºŽ Schema é©±åŠ¨çš„ UI è¿è¡Œæ—¶ç³»ç»Ÿï¼Œé€šè¿‡ MCP (Model Context Protocol) å·¥å…·è®© AI Agent åŠ¨æ€æž„å»ºå’Œä¿®æ”¹ç”¨æˆ·ç•Œé¢ã€‚

## ðŸŽ¯ æ ¸å¿ƒåˆ›æ–°

### å•ä¸€å†™å…¥è·¯å¾„æž¶æž„

**ä¼ ç»Ÿé—®é¢˜**ï¼š
- å‰ç«¯ç›´æŽ¥ä¿®æ”¹çŠ¶æ€ + åŽç«¯åŒæ­¥ â†’ ç«žæ€æ¡ä»¶
- å¤šå¤„å†™å…¥å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

**æœ¬é¡¹ç›®è§£å†³æ–¹æ¡ˆ**ï¼š
```
ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯ä¹è§‚æ›´æ–° â†’ å‘é€äº‹ä»¶ â†’ 
åŽç«¯è®¡ç®— Patch â†’ WebSocket æŽ¨é€å®Œæ•´ Schema â†’ 
å‰ç«¯æ›¿æ¢æ•´ä¸ª Schema
```

**å®žçŽ°ç»†èŠ‚**ï¼š
- Schema æ˜¯å”¯ä¸€çœŸæºï¼Œæ‰€æœ‰ä¿®æ”¹å¿…é¡»é€šè¿‡åŽç«¯ `patch_ui_state` å·¥å…·
- å‰ç«¯æ”¶åˆ°å®Œæ•´ Schema åŽç›´æŽ¥æ›¿æ¢ï¼Œä¸åšå¢žé‡æ›´æ–°
- WebSocket æŽ¨é€çš„æ¶ˆæ¯ç±»åž‹åŒ…æ‹¬ `schema_update` å’Œ `access_instance`
- æŽ¨é€æ”¯æŒé«˜äº®æç¤ºï¼Œæ·»åŠ å­—æ®µ/Action æ—¶è‡ªåŠ¨é«˜äº®æ˜¾ç¤º
- è·¨å®¢æˆ·ç«¯å®žæ—¶åŒæ­¥ï¼Œå¤šä¸ªæµè§ˆå™¨çœ‹åˆ°ç›¸åŒçš„ UI çŠ¶æ€

### å‰ç«¯è¢«åŠ¨å¼æ›´æ–°

**å®žçŽ°åŽŸç†**ï¼š
- å‰ç«¯å®Œå…¨ä¸ä¸»åŠ¨è®¡ç®—çŠ¶æ€ï¼Œåªè´Ÿè´£æ¸²æŸ“å’Œå‘é€äº‹ä»¶
- æ‰€æœ‰çŠ¶æ€æ›´æ–°ç”±åŽç«¯æŽ¨é€çš„ Schema æ›¿æ¢è§¦å‘
- ä½¿ç”¨ Zustand ç®¡ç†å…¨å±€ Schemaï¼ŒImmer ç¡®ä¿ä¸å¯å˜æ›´æ–°
- WebSocket ç›‘å¬ `schema_update` æ¶ˆæ¯ï¼Œç›´æŽ¥è°ƒç”¨ `setSchema` æ›¿æ¢
- æ›¿æ¢æ—¶ä½¿ç”¨æ·±æ‹·è´é¿å…å¼•ç”¨é—®é¢˜

**ä¼˜åŠ¿**ï¼š
- çŠ¶æ€é€»è¾‘é›†ä¸­åœ¨åŽç«¯ï¼Œå‰ç«¯ç®€åŒ–ä¸ºçº¯æ¸²æŸ“å±‚
- é¿å…å‰åŽç«¯çŠ¶æ€ä¸ä¸€è‡´
- é™ä½Žå‰ç«¯å¤æ‚åº¦ï¼Œæ— éœ€å¤æ‚çš„ reducers å’Œä¸­é—´ä»¶

### Patch æ“ä½œèŒƒå¼ç»Ÿä¸€

**æ”¯æŒçš„ 15 ç§æ“ä½œ**ï¼š
| ç±»åˆ« | æ“ä½œ | å®žçŽ°ç»†èŠ‚ |
|------|------|----------|
| ç»“æž„å˜æ›´ | `add`, `remove` | æ·»åŠ /åˆ é™¤ Block æ—¶è‡ªåŠ¨åˆå§‹åŒ–æˆ–æ¸…ç† `state.params` |
| æ•°æ®æ›´æ–° | `set`, `merge` | `set` æ”¯æŒä»»æ„è·¯å¾„æ·±åº¦ï¼Œ`merge` åˆå¹¶å¯¹è±¡å±žæ€§ |
| åˆ—è¡¨æ“ä½œ | `append_to_list`, `prepend_to_list`, `remove_from_list`, `remove_last`, `update_list_item`, `filter_list` | `filter_list` æ”¯æŒæ“ä½œç¬¦ï¼ˆ`==`, `!=`, `>`, `<`, `>=`, `<=`ï¼‰ï¼Œ`remove_from_list` æ”¯æŒ `index: -1` æ‰¹é‡åˆ é™¤ |
| åŽŸå­æ“ä½œ | `increment`, `decrement`, `toggle` | æœåŠ¡ç«¯è®¡ç®—ï¼Œé¿å…å‰ç«¯å¹¶å‘é—®é¢˜ |

**å®žçŽ°ç»†èŠ‚**ï¼š
- æ‰€æœ‰ Patch æ“ä½œåœ¨ `execute_operation` å‡½æ•°ä¸­ç»Ÿä¸€å¤„ç†
- `set` æ“ä½œç›´æŽ¥åœ¨ `apply_patch_to_schema` ä¸­å®žçŽ°ï¼Œæ”¯æŒå¤æ‚è·¯å¾„å¦‚ `blocks.0.props.fields.1.label`
- åˆ—è¡¨æ“ä½œå‰è‡ªåŠ¨æ¸²æŸ“æ¨¡æ¿å˜é‡ï¼Œç¡®ä¿ `append_to_list` çš„ `items` å¯ä»¥å¼•ç”¨ `state.params.xxx`
- åˆ é™¤ Block æ—¶è‡ªåŠ¨æ¸…ç† `state.params` ä¸­å¯¹åº”å­—æ®µçš„çŠ¶æ€
- æ‰€æœ‰æ“ä½œåŽè‡ªåŠ¨éªŒè¯ Block IDã€Field Keyã€Action ID çš„å”¯ä¸€æ€§

### æ¨¡æ¿å¼•æ“ŽæœåŠ¡ç«¯æ¸²æŸ“

**æ¨¡æ¿è¯­æ³•**ï¼š
```
${state.params.name}          # åŸºç¡€å¼•ç”¨
${state.params.status.label}    # é€‰é¡¹æ ‡ç­¾ï¼ˆå‰ç«¯æ¸²æŸ“ï¼‰
${state.runtime.timestamp}        # è¿è¡Œæ—¶æ•°æ®ï¼ˆæœåŠ¡ç«¯è‡ªåŠ¨æ›´æ–°ï¼‰
```

**å®žçŽ°ç»†èŠ‚**ï¼š
- æœåŠ¡ç«¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ `\$\{([^}]+)\}` åŒ¹é…å ä½ç¬¦
- æ”¯æŒåµŒå¥—è·¯å¾„å¦‚ `${state.params.user.name}`
- `append_to_list` ç­‰æ“ä½œçš„ `items` å‚æ•°è‡ªåŠ¨æ¸²æŸ“æ¨¡æ¿
- æ¸²æŸ“æ—¶è·³è¿‡ `field.value`ï¼Œä¿ç•™æ¨¡æ¿è¡¨è¾¾å¼ä¾›åŽç»­ä½¿ç”¨
- è¿è¡Œæ—¶æ•°æ® `state.runtime.timestamp` æ¯æ¬¡æ¸²æŸ“è‡ªåŠ¨æ›´æ–°

**å‰ç«¯å®žçŽ°**ï¼š
- ä½¿ç”¨ `renderTemplate` å‡½æ•°åœ¨å‰ç«¯å®žæ—¶æ¸²æŸ“ï¼ˆç”¨äºŽ `.label` åŽç¼€ï¼‰
- æ”¯æŒé€šè¿‡ `window.__optionLabels__` å…¨å±€å­˜å‚¨é€‰é¡¹æ ‡ç­¾
- æ•°ç»„ç±»åž‹è‡ªåŠ¨è½¬ä¸ºé€—å·åˆ†éš”å­—ç¬¦ä¸²
- æ‰¾ä¸åˆ°å€¼æ—¶ä¿ç•™åŽŸå§‹å ä½ç¬¦

### å¯ç¼–è¾‘è¡¨æ ¼ + å†…åµŒæ“ä½œ

**ç‰¹æ€§**ï¼š
- è¡Œå†…ç¼–è¾‘ï¼šè®¾ç½® `editable: true` åŽï¼Œåˆ—å¯ç›´æŽ¥ä¿®æ”¹ï¼Œè¾“å…¥æ¡†è§¦å‘ `field:change` äº‹ä»¶
- æ··åˆæ¸²æŸ“ï¼š`renderType: "mixed"` å…è®¸åœ¨å•å…ƒæ ¼ä¸­åµŒå…¥æŒ‰é’®
- æ“ä½œå…³è”ï¼šè¡¨æ ¼æŒ‰é’®ç‚¹å‡»åŽè§¦å‘å¯¹åº” `actionId` çš„ Action
- æ¸²æŸ“ç±»åž‹æ”¯æŒï¼š`tag`ã€`progress`ã€`badge` ç­‰ï¼Œç”¨äºŽä¸åŒåœºæ™¯çš„æ•°æ®å±•ç¤º

**å®žçŽ°ç»†èŠ‚**ï¼š
- è¡¨æ ¼å­—æ®µä½¿ç”¨ `TableFieldConfig` æ¨¡åž‹éªŒè¯ï¼Œ`columns` æ•°ç»„å®šä¹‰åˆ—é…ç½®
- æ¯ä¸ªåˆ—é…ç½®åŒ…æ‹¬ `key`ã€`label`ã€`type`ã€`renderType`ã€`editable` ç­‰å±žæ€§
- `components` æ•°ç»„å®šä¹‰æŒ‰é’®ï¼Œæ¯ä¸ªæŒ‰é’®åŒ…å« `type`ã€`buttonLabel`ã€`actionId`
- è¡Œå†…ç¼–è¾‘æ—¶ï¼Œå‰ç«¯å‘é€ `field:change` äº‹ä»¶ï¼ŒåŽç«¯æ›´æ–° `state.params.tableData`

### æ— é™åµŒå¥—ç»„ä»¶

**å®žçŽ°åŽŸç†**ï¼š
- é€šè¿‡ `component` å­—æ®µç±»åž‹å®žçŽ°åµŒå¥—
- `GenericFieldRenderer` é€’å½’æ¸²æŸ“ `component` ç±»åž‹çš„å­—æ®µ
- Block å†…å¯ä»¥åµŒå¥— Blockï¼Œæ”¯æŒä»»æ„æ·±åº¦
- åµŒå¥—æ—¶è‡ªåŠ¨ä¼ é€’ `schema` å’Œ `instanceName` ä¸Šä¸‹æ–‡

**å®žçŽ°ç»†èŠ‚**ï¼š
- å‰ç«¯ `BlockRenderer` ç»„ä»¶é€’å½’æ¸²æŸ“ `props.fields` å’ŒåµŒå¥—çš„ Block
- æ¯ä¸ª Block å¯ä»¥æœ‰è‡ªå·±çš„å¸ƒå±€ç±»åž‹ï¼ˆ`form`ã€`grid`ã€`tabs`ã€`accordion`ï¼‰
- åµŒå¥— Block çš„ `actions` ç‹¬ç«‹äºŽçˆ¶ Block
- æ”¯æŒåœ¨ `component` å­—æ®µä¸­åµŒå…¥å®Œæ•´çš„ Block é…ç½®

### è‡ªåŠ¨çŠ¶æ€æ¸…ç†

**å®žçŽ°åŽŸç†**ï¼š
- åˆ é™¤å­—æ®µ/Block æ—¶è‡ªåŠ¨æ¸…ç† `state.params` ä¸­å¯¹åº”æ•°æ®
- æ·»åŠ å­—æ®µæ—¶è‡ªåŠ¨åˆå§‹åŒ– `state.params` ä¸­å¯¹åº”å­—æ®µ
- ä¿®æ”¹å­—æ®µ key æ—¶è‡ªåŠ¨è¿ç§» `state.params` çš„å€¼

**å®žçŽ°ç»†èŠ‚**ï¼š
- `init_field_state` å‡½æ•°è´Ÿè´£å­—æ®µçŠ¶æ€åˆå§‹åŒ–
- åˆ é™¤ Block æ—¶éåŽ†æ‰€æœ‰å­—æ®µï¼Œæ¸…ç† `state.params` ä¸­ä¸å­˜åœ¨çš„ key
- ä¿®æ”¹å­—æ®µ key æ—¶ï¼Œå…ˆåˆ é™¤æ—§ key çš„ stateï¼Œå†æ·»åŠ æ–° key çš„ state
- ä¿ç•™æ–°å­—æ®µåˆ—è¡¨ä¸­å­˜åœ¨çš„ keyï¼Œé¿å…è¯¯åˆ 

### åŒå±‚å¯¼èˆªç³»ç»Ÿ

**å±‚çº§è¯´æ˜Ž**ï¼š
1. **å®žä¾‹å¯¼èˆª**ï¼š`action_type: "navigate"` é…åˆ `target_instance_name`ï¼Œè·¨å®žä¾‹åˆ‡æ¢é¡µé¢
2. **å—å¯¼èˆª**ï¼š`action_type: "navigate_block"` é…åˆ `target_block_id`ï¼ŒåŒå®žä¾‹å†…æ»šåŠ¨åˆ°æŒ‡å®š Block

**å®žçŽ°ç»†èŠ‚**ï¼š
- å®žä¾‹å¯¼èˆªé€šè¿‡ WebSocket å‘é€ `access_instance` æ¶ˆæ¯ï¼Œå‰ç«¯åˆ‡æ¢æ¿€æ´»å®žä¾‹
- å—å¯¼èˆªé€šè¿‡ `scrollIntoView` å¹³æ»‘æ»šåŠ¨åˆ°ç›®æ ‡å…ƒç´ 
- æ”¯æŒè¿”å›žå¯¼èˆªï¼Œé€šè¿‡ `history` æ ˆè®°å½•å¯¼èˆªè·¯å¾„
- å—å¯¼èˆªæ”¯æŒåç§»é‡ï¼Œè°ƒæ•´æ»šåŠ¨ä½ç½®

### WebSocket å®žæ—¶æŽ¨é€

**æ¶ˆæ¯ç±»åž‹**ï¼š
- `schema_update` - æŽ¨é€å®Œæ•´ Schema æ›´æ–°ï¼ŒåŒ…å« `highlight` å­—æ®µç”¨äºŽé«˜äº®æç¤º
- `access_instance` - åˆ‡æ¢æ¿€æ´»å®žä¾‹ï¼Œå‰ç«¯è‡ªåŠ¨åŠ è½½æ–°å®žä¾‹ Schema

**å®žçŽ°ç»†èŠ‚**ï¼š
- åŽç«¯ `WebSocketManager` ç®¡ç†æ‰€æœ‰è¿žæŽ¥ï¼Œæ”¯æŒå¹¿æ’­ç»™æ‰€æœ‰å®¢æˆ·ç«¯
- æ¯æ¬¡åº”ç”¨ Patch åŽï¼ŒåŽç«¯è°ƒç”¨ `broadcast_schema_update` æŽ¨é€æ›´æ–°
- æŽ¨é€å†…å®¹åŒ…å«å®Œæ•´çš„ `UISchema`ï¼Œå‰ç«¯ç›´æŽ¥æ›¿æ¢è€Œéžå¢žé‡æ›´æ–°
- æ”¯æŒé«˜äº®æç¤ºï¼Œ`highlight` å­—æ®µæŒ‡å®šéœ€è¦é«˜äº®çš„ Block ID æˆ– Action ID

### Patch åŽ†å²ä¸Žé‡æ”¾

**åŠŸèƒ½**ï¼š
- è®°å½•æ‰€æœ‰ Patch æ“ä½œåˆ°åŽ†å²
- æ”¯æŒé€šè¿‡ `patch_id` é‡æ”¾ Patch
- å¯è¿½æº¯æ•´ä¸ª UI æ¼”è¿›è¿‡ç¨‹

**å®žçŽ°ç»†èŠ‚**ï¼š
- `PatchHistoryManager` ç®¡ç†åŽ†å²è®°å½•ï¼Œæ¯ä¸ª Patch åŒ…å« `patch_id`ã€`timestamp`ã€`patches`ã€`source`
- æä¾› `get_patch_history` æŽ¥å£èŽ·å–åŽ†å²åˆ—è¡¨
- æä¾› `replay_patch` æŽ¥å£é‡æ”¾æŒ‡å®š Patchï¼Œè‡ªåŠ¨è·³è¿‡è¿‡æœŸçš„ `timestamp` å­—æ®µ
- åŽ†å²è®°å½•æŒä¹…åŒ–åˆ°å†…å­˜ï¼Œé‡å¯åŽæ¸…ç©ºï¼ˆå¯æ‰©å±•ä¸ºæŒä¹…åŒ–å­˜å‚¨ï¼‰

### Key å”¯ä¸€æ€§éªŒè¯

**éªŒè¯èŒƒå›´**ï¼š
- Block çš„ ID å¿…é¡»åœ¨æ‰€æœ‰ Block ä¸­å”¯ä¸€
- Field çš„ Key å¿…é¡»åœ¨æ‰€æœ‰ Block çš„æ‰€æœ‰ Fields ä¸­å”¯ä¸€
- Action çš„ ID å¿…é¡»åœ¨æ‰€æœ‰ Block çš„ Actions å’Œ Schema Actions ä¸­å”¯ä¸€

**å®žçŽ°ç»†èŠ‚**ï¼š
- `validate_key_uniqueness` å‡½æ•°æ‰§è¡ŒéªŒè¯
- æ¯æ¬¡ `add`ã€`remove`ã€`set` æ“ä½œåŽè‡ªåŠ¨éªŒè¯
- éªŒè¯å¤±è´¥æŠ›å‡º `ValueError`ï¼Œé˜»æ­¢ Patch åº”ç”¨
- é”™è¯¯æ¶ˆæ¯æ˜Žç¡®æŒ‡å‡ºé‡å¤çš„ ID æˆ– Key

### å¯é€‰æ ‡ç­¾åŠ¨æ€æ¸²æŸ“

**ç‰¹æ€§**ï¼š
- é€‰é¡¹å€¼å¯æ˜¾ç¤ºæ ‡ç­¾ï¼š`value: "active"` æ˜¾ç¤ºä¸º `label: "è¿›è¡Œä¸­"`
- æ¨¡æ¿ä¸­å¼•ç”¨ï¼š`${state.params.status.label}`
- è‡ªåŠ¨ä»Ž `options` æ•°ç»„åŒ¹é…

**å®žçŽ°ç»†èŠ‚**ï¼š
- å‰ç«¯ `getOptionLabel` å‡½æ•°ä»Ž `options` æ•°ç»„æŸ¥æ‰¾å¯¹åº”æ ‡ç­¾
- æ¸²æŸ“æ—¶å¤„ç† `.label` åŽç¼€ï¼Œä»Ž `window.__optionLabels__` èŽ·å–æ ‡ç­¾
- åŽç«¯æ¸²æŸ“æ¨¡æ¿æ—¶è·³è¿‡ `.label` åŽç¼€ï¼Œç”±å‰ç«¯å¤„ç†
- æ”¯æŒå•é€‰å’Œå¤šé€‰çš„æ ‡ç­¾èŽ·å–

## é¡¹ç›®ç»“æž„

```
example_web_app/
â”œâ”€â”€ backend/
â”‚   â”œâ”€â”€ fastapi/
â”‚   â”‚   â”œâ”€â”€ main.py                  # FastAPI åº”ç”¨å…¥å£ï¼Œå¯åŠ¨ WebSocket å’Œ API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”‚   â”œâ”€â”€ event_routes.py      # å¤„ç† `field:change` å’Œ `action:click` äº‹ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ patch_routes.py      # å¤„ç† `patch_ui_state` è¯·æ±‚ï¼Œåˆ›å»º/åˆ é™¤å®žä¾‹
â”‚   â”‚   â”‚   â”œâ”€â”€ schema_routes.py     # Schema æŸ¥è¯¢æŽ¥å£
â”‚   â”‚   â”‚   â””â”€â”€ websocket/           # WebSocket å®žæ—¶æŽ¨é€æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”‚   â”œâ”€â”€ instance_service.py  # å®žä¾‹åˆ›å»º/åˆ é™¤/æ›´æ–°é€»è¾‘
â”‚   â”‚   â”‚   â””â”€â”€ patch.py            # Patch æ“ä½œå¼•æ“Žï¼ŒåŒ…å« 15 ç§æ“ä½œå®žçŽ°
â”‚   â”‚   â””â”€â”€ models/
â”‚   â”‚       â”œâ”€â”€ schema_models.py     # Pydantic æ¨¡åž‹ï¼šUISchemaã€Blockã€Field ç­‰
â”‚   â”‚       â””â”€â”€ field_models.py     # å­—æ®µç±»åž‹æ¨¡åž‹ï¼šTableFieldConfig ç­‰
â”‚   â”œâ”€â”€ core/
â”‚   â”‚   â”œâ”€â”€ manager.py               # SchemaManagerï¼šç®¡ç†æ‰€æœ‰ UI Schema å®žä¾‹
â”‚   â”‚   â”œâ”€â”€ history.py               # PatchHistoryManagerï¼šè®°å½•å’Œé‡æ”¾ Patch
â”‚   â”‚   â””â”€â”€ defaults.py              # é»˜è®¤å®žä¾‹å®šä¹‰ï¼ˆdemo å®žä¾‹ï¼‰
â”‚   â””â”€â”€ mcp/
â”‚       â”œâ”€â”€ tool_definitions.py     # MCP å·¥å…·å®šä¹‰ï¼ˆæè¿°ï¼‰
â”‚       â””â”€â”€ tool_implements.py      # MCP å·¥å…·å®žçŽ°ï¼ˆè°ƒç”¨ backend APIï¼‰
â”œâ”€â”€ frontend/
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ GenericFieldRenderer.tsx   # ç»Ÿä¸€å­—æ®µæ¸²æŸ“å™¨ï¼Œåˆ†å‘åˆ° 19 ç§å­—æ®µç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ BlockRenderer.tsx          # Block å¸ƒå±€æ¸²æŸ“å™¨ï¼Œé€’å½’æ¸²æŸ“åµŒå¥— Block
â”‚   â”‚   â”‚   â”œâ”€â”€ SchemaLayoutRenderer.tsx  # é¡¶å±‚å¸ƒå±€æ¸²æŸ“å™¨ï¼ˆsingle/grid/tabs/accordionï¼‰
â”‚   â”‚   â”‚   â””â”€â”€ [33 ä¸ªå­—æ®µç»„ä»¶]           # 19 ç§å­—æ®µç±»åž‹ + é€šç”¨ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ store/
â”‚   â”‚   â”‚   â””â”€â”€ schemaStore.ts            # Zustand çŠ¶æ€ç®¡ç†ï¼Œå­˜å‚¨å½“å‰ Schema å’Œå®žä¾‹åˆ—è¡¨
â”‚   â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”‚   â””â”€â”€ template.ts               # æ¨¡æ¿å¼•æ“Žï¼Œæ”¯æŒ `${state.xxx}` è¯­æ³•
â”‚   â”‚   â””â”€â”€ types/
â”‚   â”‚       â””â”€â”€ schema.ts                 # TypeScript ç±»åž‹å®šä¹‰ï¼Œä¸ŽåŽç«¯ Pydantic æ¨¡åž‹å¯¹åº”
â””â”€â”€ docs/
    â””â”€â”€ [7 ä¸ªæ–‡æ¡£]                        # Schemaã€å·¥å…·ã€å­—æ®µç±»åž‹ã€æ¨¡æ¿è¯­æ³•ã€å¸ƒå±€ç­‰å‚è€ƒ
```

## åŠŸèƒ½æ¨¡å—

### åŽç«¯æ¨¡å—

- **FastAPI** - æä¾› REST API å’Œ WebSocket æœåŠ¡
- **SchemaManager** - ç®¡ç†æ‰€æœ‰ UI Schema å®žä¾‹ï¼Œæ”¯æŒå¢žåˆ æ”¹æŸ¥
- **InstanceService** - å¤„ç†å®žä¾‹åˆ›å»º/åˆ é™¤/æ›´æ–°é€»è¾‘ï¼Œåˆå§‹åŒ–é»˜è®¤çŠ¶æ€
- **PatchHistoryManager** - è®°å½• Patch æ“ä½œåŽ†å²ï¼Œæ”¯æŒé‡æ”¾
- **WebSocketManager** - å®žæ—¶æŽ¨é€ Schema æ›´æ–°ï¼Œè·¨å®¢æˆ·ç«¯åŒæ­¥

### å‰ç«¯æ¨¡å—

- **React 18 + Vite** - UI æ¡†æž¶å’Œæž„å»ºå·¥å…·
- **Zustand** - è½»é‡çº§çŠ¶æ€ç®¡ç†ï¼Œå­˜å‚¨å½“å‰ Schema å’Œå®žä¾‹åˆ—è¡¨
- **Immer** - ä¸å¯å˜æ•°æ®æ›´æ–°ï¼Œç¡®ä¿çŠ¶æ€ä¸€è‡´æ€§
- **Field ç»„ä»¶** - 19 ç§å­—æ®µç±»åž‹çš„æ¸²æŸ“ç»„ä»¶ï¼ˆtextã€numberã€selectã€table ç­‰ï¼‰
- **Layout ç»„ä»¶** - 4 ç§å¸ƒå±€æ–¹å¼çš„å®¹å™¨ç»„ä»¶ï¼ˆformã€gridã€tabsã€accordionï¼‰

### MCP å·¥å…·

- `patch_ui_state` - åº”ç”¨ Patchï¼ˆæ ¸å¿ƒå·¥å…·ï¼‰ï¼Œæ”¯æŒ 15 ç§æ“ä½œ
- `get_schema` - èŽ·å–å®Œæ•´ Schema
- `list_instances` - åˆ—å‡ºæ‰€æœ‰å®žä¾‹
- `access_instance` - æ¿€æ´»å®žä¾‹
- `validate_completion` - éªŒè¯å®Œæˆæ¡ä»¶

## å¿«é€Ÿå¼€å§‹

### å®‰è£…ä¾èµ–

```bash
# åŽç«¯
cd backend
pip install -r requirements.txt

# å‰ç«¯
cd frontend
npm install
```

### å¯åŠ¨æœåŠ¡

```bash
# åŽç«¯ (ç»ˆç«¯ 1)
cd backend
uvicorn backend.fastapi.main:app --host 0.0.0.0 --port 8001 --reload

# å‰ç«¯ (ç»ˆç«¯ 2)
cd frontend
npm run dev

# MCP æœåŠ¡ (ç»ˆç«¯ 3ï¼Œå¯é€‰)
cd backend/mcp
python tools.py
```

è®¿é—® `http://localhost:5173`

## é»˜è®¤å®žä¾‹

å¯åŠ¨åŽåŒ…å«ä¸€ä¸ª `demo` å®žä¾‹ï¼Œå±•ç¤ºæ‰€æœ‰åŠŸèƒ½ï¼š
- è®¡æ•°å™¨ï¼ˆincrement/decrementï¼‰
- åŠ¨æ€åˆ—è¡¨ï¼ˆappend_to_listï¼‰
- å¯ç¼–è¾‘è¡¨æ ¼
- é€‰é¡¹ç»„ä»¶
- å›¾ç‰‡ç»„ä»¶
- Grid/Tabs/Accordion å¸ƒå±€
- å—å¯¼èˆª

## é…ç½®

### Claude Desktop

```json
{
  "mcpServers": {
    "ui-patch-server": {
      "command": "python",
      "args": ["/path/to/project/backend/mcp/tools.py"],
      "env": {
        "PYTHONPATH": "/path/to/project"
      }
    }
  }
}
```

### Cline (VS Code)

```yaml
mcpServers:
  ui-patch-server:
    command: python
    args: ["./backend/mcp/tools.py"]
    env:
      PYTHONPATH: ./
```

## æ–‡æ¡£

è¯¦ç»†æ–‡æ¡£è§ [docs/](docs/)ï¼š

- [Schema Guide](docs/schema-guide.md) - UI Schema ç»“æž„
- [Tools Reference](docs/tools-reference.md) - MCP å·¥å…·æ–‡æ¡£
- [PTA Tool Reference](docs/pta-tool-reference.md) - PTA å·¥å…·å‚è€ƒ
- [Field Types](docs/field-types.md) - å­—æ®µç±»åž‹è¯¦è§£
- [Template Syntax](docs/template-syntax.md) - æ¨¡æ¿è¯­æ³•
- [Layout Guide](docs/layout-guide.md) - å¸ƒå±€ç³»ç»Ÿ

---

Built with FastAPI, React, and FastMCP
