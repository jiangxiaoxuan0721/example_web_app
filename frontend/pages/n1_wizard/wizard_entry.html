<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>N-1仿真向导 - SIMBOT电力系统分析平台</title>
    <link rel="stylesheet" href="/pages/n1_wizard/../../main.css">
    <link rel="stylesheet" href="/pages/n1_wizard/n1_wizard.css">
    <link rel="stylesheet" href="/pages/n1_wizard/../../components/buttons/buttons.css">
    <link rel="stylesheet" href="/pages/n1_wizard/../../components/tables/tables.css">
</head>
<body>
    <div class="container">
        <header class="header">
            <div class="header-left">
                <button id="backBtn" class="btn btn-secondary">返回主页</button>
            </div>
            <div class="header-center">
                <h1>N-1 仿真向导</h1>
                <p class="subtitle">N-1 Simulation Wizard</p>
            </div>
            <div class="header-right">
                <button id="refreshBtn" class="btn btn-secondary">刷新</button>
                <button id="helpBtn" class="btn btn-secondary">帮助</button>
            </div>
        </header>

        <main class="main-content">
            <div class="wizard-container">
                <!-- 模式选择 -->
                <div id="modeSelection" class="step-content active">
                    <div class="step-header">
                        <h2>选择仿真模式</h2>
                        <p>请选择您要执行的N-1仿真模式</p>
                    </div>
                    <div class="mode-cards">
                        <div class="mode-card" data-mode="single">
                            <div class="mode-icon">1</div>
                            <h3>Model A: 单次 N-1 仿真</h3>
                            <p>执行单个N-1故障仿真，适用于特定故障场景的详细分析</p>
                            <button class="btn btn-primary select-mode-btn" data-mode="single">选择此模式</button>
                        </div>
                        <div class="mode-card" data-mode="batch">
                            <div class="mode-icon">2</div>
                            <h3>Model B: 批量 N-1 仿真</h3>
                            <p>执行多个N-1故障仿真，适用于系统稳定性的全面分析</p>
                            <button class="btn btn-primary select-mode-btn" data-mode="batch">选择此模式</button>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- 帮助对话框 -->
    <div id="helpDialog" class="dialog-overlay" style="display: none;">
        <div class="dialog">
            <div class="dialog-header">
                <h3>N-1仿真帮助</h3>
                <button id="closeHelpBtn" class="btn btn-icon">X</button>
            </div>
            <div class="dialog-content">
                <h4>什么是N-1仿真？</h4>
                <p>N-1仿真是电力系统稳定性分析的重要方法，用于评估系统在单个元件故障后的稳定运行能力。本向导将帮助您完成整个仿真流程。</p>
                
                <h4>仿真模式说明</h4>
                <p><strong>Model A (单次仿真)</strong>: 适用于分析特定故障场景的详细情况，可以手动设置故障参数并立即查看结果。</p>
                <p><strong>Model B (批量仿真)</strong>: 适用于对系统进行全面分析，可以配置多个故障场景并批量执行仿真，最后比较所有结果。</p>
                
                <h4>使用指南</h4>
                <ol>
                    <li>选择仿真模式（单次或批量）</li>
                    <li>按照步骤导航器指示完成每个步骤</li>
                    <li>在各步骤中设置相应参数或查看结果</li>
                    <li>完成所有步骤后查看最终仿真结果</li>
                </ol>
            </div>
        </div>
    </div>

    <!-- JavaScript模块 -->
    <script src="/pages/n1_wizard/../../components/wizard_navigation/wizard_navigation.js"></script>
    <script src="/pages/n1_wizard/../../components/wizard_state/wizard_state.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化导航器和状态管理器
            window.wizardNavigation = new WizardNavigation();
            window.wizardStateManager = new WizardStateManager({
                storageKey: 'n1_wizard_state'
            });

            // 绑定返回按钮
            document.getElementById('backBtn').addEventListener('click', () => {
                window.location.href = '/pages/index.html';
            });

            // 绑定刷新按钮
            document.getElementById('refreshBtn').addEventListener('click', () => {
                window.location.reload();
            });

            // 绑定帮助按钮
            document.getElementById('helpBtn').addEventListener('click', () => {
                document.getElementById('helpDialog').style.display = 'flex';
            });

            // 绑定关闭帮助按钮
            document.getElementById('closeHelpBtn').addEventListener('click', () => {
                document.getElementById('helpDialog').style.display = 'none';
            });

            // 点击对话框外部关闭
            document.getElementById('helpDialog').addEventListener('click', (e) => {
                if (e.target === document.getElementById('helpDialog')) {
                    document.getElementById('helpDialog').style.display = 'none';
                }
            });

            // 模式选择按钮
            document.querySelectorAll('.select-mode-btn').forEach(btn => {
                btn.addEventListener('click', () => {
                    const mode = btn.dataset.mode;

                    // 初始化导航器
                    window.wizardNavigation.clearState();
                    window.wizardStateManager.clearState();

                    // 设置模式并获取第一步URL
                    const totalSteps = mode === 'single' ? 8 : 6;
                    const titles = mode === 'single' ? [
                        '加载模型', '潮流计算配置', '执行潮流计算',
                        '故障参数设置', '电磁暂态配置', '添加量测信号',
                        '执行仿真', '结果分析'
                    ] : [
                        '查看默认配置', '确认流程模板', '配置参数',
                        '生成批量配置', '参数检查与确认', '提交批量任务'
                    ];

                    window.wizardNavigation.options.totalSteps = totalSteps;
                    window.wizardNavigation.options.titles = titles;
                    window.wizardNavigation.options.mode = mode;
                    window.wizardNavigation.init();
                    const firstStepUrl = window.wizardNavigation.goToStep(0);

                    // 设置状态管理器的模式
                    window.wizardStateManager.setMode(mode);
                    window.wizardStateManager.setCurrentStep(0);

                    // 导航到第一步
                    window.location.href = firstStepUrl;
                });
            });
        });
    </script>
</body>
</html>