# é¡¹ç›®äº¤ä»˜æ–‡æ¡£

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### é¡¹ç›®åç§°
Agent Programmable UI Runtime (APUI) - åŸºäº Schema é©±åŠ¨çš„ UI è¿è¡Œæ—¶ç³»ç»Ÿ

### é¡¹ç›®ç®€ä»‹
æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåˆ›æ–°çš„ Web åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œé€šè¿‡ MCP (Model Context Protocol) å·¥å…·è®© AI Agent åŠ¨æ€æ„å»ºå’Œä¿®æ”¹ç”¨æˆ·ç•Œé¢ã€‚æ ¸å¿ƒç‰¹è‰²æ˜¯**å•ä¸€å†™å…¥è·¯å¾„æ¶æ„**ï¼Œå³æ‰€æœ‰ UI çŠ¶æ€çš„ä¿®æ”¹å¿…é¡»é€šè¿‡åç«¯ `patch_ui_state` å·¥å…·å®Œæˆï¼Œå‰ç«¯è´Ÿè´£æ¸²æŸ“å’Œå‘é€äº‹ä»¶ï¼Œé¿å…äº†ä¼ ç»Ÿå‰åç«¯çŠ¶æ€ä¸åŒæ­¥çš„é—®é¢˜ã€‚

### æŠ€æœ¯æ ˆ
- **åç«¯**: FastAPI + Python 3.x + Pydantic
- **å‰ç«¯**: React 18 + TypeScript + Vite
- **çŠ¶æ€ç®¡ç†**: Zustand + Immer
- **å®æ—¶é€šä¿¡**: WebSocket
- **åè®®**: MCP (Model Context Protocol)

### æ ¸å¿ƒåˆ›æ–°ç‚¹
1. **å•ä¸€å†™å…¥è·¯å¾„æ¶æ„**: Schema æ˜¯å”¯ä¸€çœŸæºï¼Œæ‰€æœ‰ä¿®æ”¹å¿…é¡»é€šè¿‡åç«¯ `patch_ui_state` å·¥å…·
2. **å‰ç«¯è¢«åŠ¨å¼æ›´æ–°**: å‰ç«¯åªè´Ÿè´£æ¸²æŸ“å’Œå‘é€äº‹ä»¶ï¼Œæ‰€æœ‰çŠ¶æ€æ›´æ–°ç”±åç«¯æ¨é€çš„ Schema æ›¿æ¢è§¦å‘
3. **Patch æ“ä½œèŒƒå¼ç»Ÿä¸€**: æ”¯æŒ 15 ç§æ“ä½œç±»å‹ï¼ˆaddã€removeã€setã€mergeã€append_to_list ç­‰ï¼‰
4. **æ¨¡æ¿å¼•æ“æœåŠ¡ç«¯æ¸²æŸ“**: æ”¯æŒ `${state.params.xxx}` è¯­æ³•å¼•ç”¨çŠ¶æ€å€¼
5. **æ— é™åµŒå¥—ç»„ä»¶**: é€šè¿‡ `component` å­—æ®µç±»å‹å®ç°ä»»æ„æ·±åº¦çš„ç»„ä»¶åµŒå¥—
6. **è‡ªåŠ¨çŠ¶æ€æ¸…ç†**: åˆ é™¤å­—æ®µ/Block æ—¶è‡ªåŠ¨æ¸…ç† `state.params` ä¸­å¯¹åº”æ•°æ®
7. **åŒå±‚å¯¼èˆªç³»ç»Ÿ**: æ”¯æŒå®ä¾‹å¯¼èˆªå’Œå—å¯¼èˆª

---

## ğŸ“ é¡¹ç›®ç»“æ„è¯¦è§£

```
example_web_app/
â”œâ”€â”€ backend/                    # åç«¯ä»£ç  (Python + FastAPI)
â”‚   â”œâ”€â”€ fastapi/               # FastAPI åº”ç”¨
â”‚   â”‚   â”œâ”€â”€ main.py            # åº”ç”¨å…¥å£ï¼Œå¯åŠ¨ WebSocket å’Œ API æœåŠ¡
â”‚   â”‚   â”œâ”€â”€ models/            # Pydantic æ•°æ®æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ base.py        # åŸºç¡€æ¨¡å‹ç±»
â”‚   â”‚   â”‚   â”œâ”€â”€ enums.py       # æšä¸¾å®šä¹‰
â”‚   â”‚   â”‚   â”œâ”€â”€ schema_models.py      # Schema æ ¸å¿ƒæ¨¡å‹ (UISchema, Block, Field, Action)
â”‚   â”‚   â”‚   â”œâ”€â”€ block_models.py       # Block ç›¸å…³æ¨¡å‹
â”‚   â”‚   â”‚   â”œâ”€â”€ field_models.py       # Field ç›¸å…³æ¨¡å‹ (19ç§å­—æ®µç±»å‹)
â”‚   â”‚   â”‚   â””â”€â”€ patch_models.py       # Patch ç›¸å…³æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ routes/            # API è·¯ç”±
â”‚   â”‚   â”‚   â”œâ”€â”€ event_routes.py       # äº‹ä»¶å¤„ç† (field:change, action:click)
â”‚   â”‚   â”‚   â”œâ”€â”€ patch_routes.py       # Patch æ“ä½œ (patch_ui_state)
â”‚   â”‚   â”‚   â”œâ”€â”€ schema_routes.py      # Schema æŸ¥è¯¢ (get_schema, list_instances)
â”‚   â”‚   â”‚   â””â”€â”€ websocket/            # WebSocket è·¯ç”±
â”‚   â”‚   â”‚       â””â”€â”€ routes.py         # WebSocket è¿æ¥å’Œæ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ instance_service.py   # å®ä¾‹åˆ›å»º/åˆ é™¤/æ›´æ–°é€»è¾‘
â”‚   â”‚   â”‚   â”œâ”€â”€ websocket/            # WebSocket ç®¡ç†
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ manager.py         # WebSocketManager (ç®¡ç†æ‰€æœ‰è¿æ¥)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ handlers.py        # WebSocket æ¶ˆæ¯å¤„ç†å™¨
â”‚   â”‚   â”‚   â””â”€â”€ patch.py              # Patch æ“ä½œå¼•æ“ (15ç§æ“ä½œå®ç°)
â”‚   â”œâ”€â”€ core/                  # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ manager.py         # SchemaManager (ç®¡ç†æ‰€æœ‰ UI Schema å®ä¾‹)
â”‚   â”‚   â”œâ”€â”€ history.py         # PatchHistoryManager (è®°å½•å’Œé‡æ”¾ Patch)
â”‚   â”‚   â””â”€â”€ defaults.py        # é»˜è®¤å®ä¾‹å®šä¹‰ (demo å®ä¾‹)
â”‚   â”œâ”€â”€ mcp/                   # MCP å·¥å…·
â”‚   â”‚   â”œâ”€â”€ tool_definitions.py    # MCP å·¥å…·å®šä¹‰ (æè¿°)
â”‚   â”‚   â””â”€â”€ tool_implements.py     # MCP å·¥å…·å®ç° (è°ƒç”¨ backend API)
â”‚   â”œâ”€â”€ config.py              # é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ requirements.txt       # Python ä¾èµ–
â”‚
â”œâ”€â”€ frontend/                  # å‰ç«¯ä»£ç  (React + TypeScript)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ components/        # React ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ App.tsx                # åº”ç”¨å…¥å£ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ GenericFieldRenderer.tsx   # ç»Ÿä¸€å­—æ®µæ¸²æŸ“å™¨ (åˆ†å‘åˆ°19ç§å­—æ®µç»„ä»¶)
â”‚   â”‚   â”‚   â”œâ”€â”€ BlockRenderer.tsx          # Block å¸ƒå±€æ¸²æŸ“å™¨ (é€’å½’æ¸²æŸ“åµŒå¥—Block)
â”‚   â”‚   â”‚   â”œâ”€â”€ SchemaLayoutRenderer.tsx  # é¡¶å±‚å¸ƒå±€æ¸²æŸ“å™¨ (single/grid/tabs/accordion)
â”‚   â”‚   â”‚   â”œâ”€â”€ InputField.tsx            # æ–‡æœ¬è¾“å…¥æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ NumberInput.tsx           # æ•°å­—è¾“å…¥æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ TextArea.tsx             # å¤šè¡Œæ–‡æœ¬æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ Select.tsx                # ä¸‹æ‹‰é€‰æ‹©æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ RadioGroup.tsx           # å•é€‰æ¡†ç»„
â”‚   â”‚   â”‚   â”œâ”€â”€ MultiSelect.tsx           # å¤šé€‰æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ CheckBox.tsx              # å¤é€‰æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ Table.tsx                 # è¡¨æ ¼ç»„ä»¶ (æ”¯æŒè¡Œç¼–è¾‘)
â”‚   â”‚   â”‚   â”œâ”€â”€ DatePicker.tsx           # æ—¥æœŸé€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ DateTimePicker.tsx       # æ—¥æœŸæ—¶é—´é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ FileUpload.tsx           # æ–‡ä»¶ä¸Šä¼ 
â”‚   â”‚   â”‚   â”œâ”€â”€ ImageRenderer.tsx         # å›¾ç‰‡æ¸²æŸ“å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Tag.tsx                   # æ ‡ç­¾ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.tsx                 # å¾½ç« ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ Progress.tsx              # è¿›åº¦æ¡
â”‚   â”‚   â”‚   â”œâ”€â”€ JSONViewer.tsx            # JSON å±•ç¤ºå™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.tsx                 # æ¨¡æ€æ¡†
â”‚   â”‚   â”‚   â”œâ”€â”€ ActionButton.tsx          # æ“ä½œæŒ‰é’®
â”‚   â”‚   â”‚   â”œâ”€â”€ InstanceSelector.tsx      # å®ä¾‹é€‰æ‹©å™¨
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.tsx              # ä¾§è¾¹æ 
â”‚   â”‚   â”‚   â”œâ”€â”€ PatchHistory.tsx          # Patch å†å²è®°å½•
â”‚   â”‚   â”‚   â””â”€â”€ [å…¶ä»–UIç»„ä»¶...]            # Loading, ErrorState, Alertç­‰
â”‚   â”‚   â”œâ”€â”€ store/             # çŠ¶æ€ç®¡ç† (Zustand)
â”‚   â”‚   â”‚   â”œâ”€â”€ schemaStore.ts            # Schema Store (å”¯ä¸€çœŸæº)
â”‚   â”‚   â”‚   â””â”€â”€ multiInstanceStore.ts     # å¤šå®ä¾‹ Store (æ”¯æŒåµŒå¥—æ¸²æŸ“)
â”‚   â”‚   â”œâ”€â”€ utils/             # å·¥å…·å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ api.ts                   # API è°ƒç”¨å‡½æ•°
â”‚   â”‚   â”‚   â”œâ”€â”€ eventEmitter.ts          # äº‹ä»¶å‘å°„å™¨ (å‘é€äº‹ä»¶åˆ°åç«¯)
â”‚   â”‚   â”‚   â”œâ”€â”€ patch.ts                 # Patch å¤„ç†å·¥å…·
â”‚   â”‚   â”‚   â”œâ”€â”€ template.ts              # æ¨¡æ¿å¼•æ“ (æ¸²æŸ“ ${state.xxx})
â”‚   â”‚   â”‚   â””â”€â”€ url.ts                   # URL å¤„ç†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ hooks/             # React Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useSchema.ts              # Schema åŠ è½½å’Œç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ useWebSocket.ts           # WebSocket è¿æ¥å’Œæ¶ˆæ¯å¤„ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ usePatchHistory.ts       # Patch å†å²ç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ useEventEmitter.ts        # äº‹ä»¶å‘å°„å™¨ Hook
â”‚   â”‚   â”œâ”€â”€ types/             # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â”‚   â””â”€â”€ schema.ts                 # Schema ç±»å‹å®šä¹‰ (ä¸åç«¯ Pydantic æ¨¡å‹å¯¹åº”)
â”‚   â”‚   â”œâ”€â”€ App.tsx             # åº”ç”¨æ ¹ç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ main.tsx            # åº”ç”¨å…¥å£
â”‚   â”‚   â””â”€â”€ index.css           # å…¨å±€æ ·å¼
â”‚   â”œâ”€â”€ package.json            # å‰ç«¯ä¾èµ–é…ç½®
â”‚   â”œâ”€â”€ tsconfig.json           # TypeScript é…ç½®
â”‚   â””â”€â”€ vite.config.ts          # Vite æ„å»ºé…ç½®
â”‚
â”œâ”€â”€ docs/                      # é¡¹ç›®æ–‡æ¡£
â”‚   â”œâ”€â”€ schema-guide.md         # Schema ç»“æ„è¯´æ˜
â”‚   â”œâ”€â”€ tools-reference.md      # MCP å·¥å…·å‚è€ƒ
â”‚   â”œâ”€â”€ pta-tool-reference.md   # PTA å·¥å…·å‚è€ƒ
â”‚   â”œâ”€â”€ field-types.md          # å­—æ®µç±»å‹è¯¦è§£ (19ç§)
â”‚   â”œâ”€â”€ template-syntax.md      # æ¨¡æ¿è¯­æ³•è¯´æ˜
â”‚   â””â”€â”€ layout-guide.md         # å¸ƒå±€ç³»ç»Ÿè¯´æ˜
â”‚
â”œâ”€â”€ tests/                     # æµ‹è¯•æ–‡ä»¶
â”‚   â”œâ”€â”€ test_backend.py        # åç«¯æµ‹è¯•
â”‚   â”œâ”€â”€ test_frontend.py       # å‰ç«¯æµ‹è¯•
â”‚   â””â”€â”€ test_integration.py    # é›†æˆæµ‹è¯•
â”‚
â”œâ”€â”€ README.md                  # é¡¹ç›®è¯´æ˜
â”œâ”€â”€ äº¤ä»˜æ–‡æ¡£.md               # æœ¬æ–‡æ¡£
â””â”€â”€ TEMPLATE_USAGE.md         # æ¨¡æ¿è¯­æ³•ä½¿ç”¨æŒ‡å—
```

---

## ğŸ”‘ é‡è¦æ–‡ä»¶è¯¦è§£

### åç«¯æ ¸å¿ƒæ–‡ä»¶

#### 1. `backend/fastapi/main.py` - åº”ç”¨å…¥å£

**èŒè´£**: FastAPI åº”ç”¨å¯åŠ¨å…¥å£ï¼Œåˆå§‹åŒ–æ‰€æœ‰æœåŠ¡å’Œè·¯ç”±

**å…³é”®ä»£ç åˆ†æ**:
```python
# åˆ›å»ºæœåŠ¡å®ä¾‹
schema_manager: SchemaManager = SchemaManager()      # ç®¡ç†æ‰€æœ‰ Schema å®ä¾‹
instance_service: InstanceService = InstanceService(schema_manager)  # å®ä¾‹æ“ä½œ
patch_history: PatchHistoryManager = PatchHistoryManager()  # Patch å†å²
ws_manager: WebSocketManager = WebSocketManager()    # WebSocket ç®¡ç†

# åˆå§‹åŒ–é»˜è®¤å®ä¾‹ (demo å®ä¾‹)
for instance_name, schema in get_default_instances().items():
    schema_manager.set(instance_name, schema)

# æ³¨å†Œè·¯ç”±
register_event_routes(app, schema_manager, instance_service, patch_history, ws_manager)
register_patch_routes(app, schema_manager, patch_history, ws_manager, instance_service)
register_schema_routes(app, schema_manager, default_instance_name, ws_manager)
register_websocket_routes(app, ws_manager)
```

**å…³é”®ç‚¹**:
- æ‰€æœ‰æœåŠ¡é€šè¿‡ä¾èµ–æ³¨å…¥çš„æ–¹å¼åˆå§‹åŒ–
- é»˜è®¤å®ä¾‹åœ¨åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åŠ è½½
- WebSocket ç®¡ç†å™¨å­˜å‚¨åœ¨ `app.state` ä¸­ä¾›è·¯ç”±è®¿é—®

---

#### 2. `backend/core/manager.py` - Schema å®ä¾‹ç®¡ç†å™¨

**èŒè´£**: ç®¡ç†æ‰€æœ‰ UI Schema å®ä¾‹çš„å¢åˆ æ”¹æŸ¥

**æ ¸å¿ƒåŠŸèƒ½**:
```python
class SchemaManager:
    def get(self, instance_name: str) -> UISchema | None     # è·å–å®ä¾‹
    def set(self, instance_name: str, schema: UISchema)     # è®¾ç½®/æ›´æ–°å®ä¾‹
    def delete(self, instance_name: str) -> bool           # åˆ é™¤å®ä¾‹
    def exists(self, instance_name: str) -> bool            # æ£€æŸ¥å®ä¾‹æ˜¯å¦å­˜åœ¨
    def list_all(self) -> list[str]                        # åˆ—å‡ºæ‰€æœ‰å®ä¾‹ ID
    def get_info(self, instance_name: str) -> dict         # è·å–å®ä¾‹è¯¦ç»†ä¿¡æ¯
```

**ä½¿ç”¨åœºæ™¯**: æ‰€æœ‰ API è·¯ç”±é€šè¿‡ `schema_manager` æ“ä½œ Schema å®ä¾‹

---

#### 3. `backend/core/history.py` - Patch å†å²ç®¡ç†å™¨

**èŒè´£**: è®°å½•æ‰€æœ‰ Patch æ“ä½œï¼Œæ”¯æŒå†å²æŸ¥è¯¢å’Œé‡æ”¾

**æ ¸å¿ƒåŠŸèƒ½**:
```python
class PatchHistoryManager:
    def save(self, instance_name: str, patch: dict) -> int   # ä¿å­˜ Patchï¼Œè¿”å› Patch ID
    def get_all(self, instance_name: str) -> list           # è·å–å®ä¾‹çš„æ‰€æœ‰ Patch å†å²
    def get_by_id(self, instance_name: str, patch_id: int)  # æ ¹æ® ID è·å–ç‰¹å®š Patch
    def clear(self, instance_name: str)                     # æ¸…ç©ºå®ä¾‹çš„ Patch å†å²
    def count(self, instance_name: str) -> int              # è·å–å®ä¾‹çš„ Patch æ•°é‡
```

**ä½¿ç”¨åœºæ™¯**: 
- æ¯æ¬¡ `patch_ui_state` æ“ä½œåè‡ªåŠ¨è®°å½•å†å²
- å‰ç«¯å¯æŸ¥çœ‹å’Œé‡æ”¾å†å² Patch
- ç”¨äºè°ƒè¯•å’Œè¿½æº¯ UI æ¼”è¿›è¿‡ç¨‹

---

#### 4. `backend/core/defaults.py` - é»˜è®¤å®ä¾‹å®šä¹‰

**èŒè´£**: å®šä¹‰é»˜è®¤åŠ è½½çš„ Schema å®ä¾‹ï¼ˆç›®å‰åªæœ‰ `demo` å®ä¾‹ï¼‰

**demo å®ä¾‹å†…å®¹**: åŒ…å« 12 ä¸ª Blockï¼Œå±•ç¤ºæ‰€æœ‰åŠŸèƒ½
- è®¡æ•°å™¨ï¼ˆincrement/decrementï¼‰
- åŠ¨æ€åˆ—è¡¨ï¼ˆappend_to_listï¼‰
- å¯ç¼–è¾‘è¡¨æ ¼ï¼ˆè¡Œé€‰æ‹©ã€è¡Œç¼–è¾‘ï¼‰
- é€‰é¡¹ç»„ä»¶ï¼ˆselectã€radioã€multiselectï¼‰
- æ—¥æœŸæ—¶é—´ç»„ä»¶
- API è°ƒç”¨ç»„ä»¶
- æ–‡ä»¶ä¸Šä¼ ç»„ä»¶
- å›¾ç‰‡ç»„ä»¶
- Grid å¸ƒå±€
- Tabs å¸ƒå±€
- Accordion å¸ƒå±€
- å¯¼èˆªåŠŸèƒ½æ¼”ç¤º

**å¦‚ä½•æ·»åŠ æ–°å®ä¾‹**: åœ¨ `get_default_instances()` å‡½æ•°ä¸­æ·»åŠ æ–°çš„ Key-Value å¯¹

---

#### 5. `backend/fastapi/models/schema_models.py` - Schema æ ¸å¿ƒæ¨¡å‹

**èŒè´£**: å®šä¹‰ Schema çš„æ ¸å¿ƒæ•°æ®ç»“æ„

**æ ¸å¿ƒæ¨¡å‹**:
```python
class UISchema(BaseModelWithConfig):
    page_key: str                      # é¡µé¢é”®
    state: StateInfo                    # çŠ¶æ€ä¿¡æ¯
    layout: LayoutInfo                  # å¸ƒå±€ä¿¡æ¯
    blocks: list[Block]                # Block åˆ—è¡¨
    actions: list[ActionConfig]        # æ“ä½œåˆ—è¡¨

class StateInfo(BaseModelWithConfig):
    params: dict[str, Any]             # å­—æ®µå‚æ•°å€¼
    runtime: dict[str, Any]            # è¿è¡Œæ—¶ä¿¡æ¯

class LayoutInfo(BaseModelWithConfig):
    type: LayoutType                    # å¸ƒå±€ç±»å‹: single/grid/flex/tabs
    columns: int | None                # åˆ—æ•° (ä»…gridå¸ƒå±€)
    gap: str | None                    # é—´è·
```

**å…³é”®ç‚¹**: 
- `state.params` å­˜å‚¨æ‰€æœ‰å­—æ®µçš„å€¼ï¼Œæ˜¯ç”¨æˆ·æ“ä½œçš„æ•°æ®æº
- `state.runtime` å­˜å‚¨è¿è¡Œæ—¶æ•°æ®ï¼ˆå¦‚æ—¶é—´æˆ³ã€API å“åº”ï¼‰

---

#### 6. `backend/fastapi/models/field_models.py` - å­—æ®µç±»å‹æ¨¡å‹

**èŒè´£**: å®šä¹‰ 19 ç§å­—æ®µç±»å‹çš„é…ç½®æ¨¡å‹

**å­—æ®µç±»å‹**:
1. **åŸºç¡€ç±»å‹**: `text`, `number`, `textarea`, `json`
2. **é€‰æ‹©ç±»å‹**: `select`, `radio`, `multiselect`, `checkbox`
3. **æ—¥æœŸç±»å‹**: `date`, `datetime`
4. **æ–‡ä»¶ç±»å‹**: `file`
5. **å±•ç¤ºç±»å‹**: `html`, `image`, `tag`, `badge`, `progress`
6. **å¤æ‚ç±»å‹**: `table`, `modal`, `component`

**æ ¸å¿ƒæ¨¡å‹**:
```python
class BaseFieldConfig(_BaseFieldConfig):
    type: FieldType
    # é€‚ç”¨äº: text, number, textarea, date, datetime, file, html, json

class SelectableFieldConfig(_BaseFieldConfig):
    type: Literal[FieldType.SELECT, FieldType.RADIO, FieldType.MULTISELECT]
    options: list[OptionItem]       # é€‰é¡¹åˆ—è¡¨

class TableFieldConfig(_BaseFieldConfig):
    type: Literal[FieldType.TABLE]
    columns: list[ColumnConfig]     # è¡¨æ ¼åˆ—é…ç½®
    rowKey: str                      # è¡Œå”¯ä¸€æ ‡è¯†å­—æ®µ
    tableEditable: bool              # æ˜¯å¦å¯ç¼–è¾‘
    rowSelection: bool               # æ˜¯å¦æ”¯æŒè¡Œé€‰æ‹©

class ImageFieldConfig(_BaseFieldConfig):
    type: Literal[FieldType.IMAGE]
    imageHeight: str                 # å›¾ç‰‡é«˜åº¦
    imageFit: Literal['contain', 'cover', 'fill']  # å›¾ç‰‡é€‚åº”æ–¹å¼
```

**å…³é”®ç‚¹**: ä½¿ç”¨ Pydantic çš„åˆ¤åˆ«å¼è”åˆç±»å‹ï¼Œæ ¹æ® `type` å­—æ®µè‡ªåŠ¨éªŒè¯é…ç½®

---

#### 7. `backend/fastapi/models/block_models.py` - Block ç›¸å…³æ¨¡å‹

**èŒè´£**: å®šä¹‰ Block å’Œ Action çš„é…ç½®æ¨¡å‹

**æ ¸å¿ƒæ¨¡å‹**:
```python
class ActionConfig(BaseModelWithConfig):
    id: str                           # æ“ä½œ ID (å¿…é¡»å”¯ä¸€)
    label: str                        # æ“ä½œæ ‡ç­¾
    style: Literal['primary', 'secondary', 'danger', 'warning', 'success']
    action_type: ActionType           # æ“ä½œç±»å‹: patch/api/navigate/navigate_block
    patches: list[SchemaPatch] | None  # Patch æ•°ç»„
    api: ExternalApiConfig | None     # å¤–éƒ¨ API é…ç½®
    target_instance: str | None       # ç›®æ ‡å®ä¾‹ ID (navigate æ—¶ä½¿ç”¨)
    target_block: str | None          # ç›®æ ‡ Block ID (navigate_block æ—¶ä½¿ç”¨)
    disabled: bool                    # æ˜¯å¦ç¦ç”¨

class BlockProps(BaseModelWithConfig):
    fields: list[Any] | None          # å­—æ®µåˆ—è¡¨
    actions: list[ActionConfig] | None # Block çº§åˆ«çš„æ“ä½œæŒ‰é’®
    tabs: list[dict[str, Any]] | None # æ ‡ç­¾é¡µé…ç½® (tabså¸ƒå±€)
    cols: int | None                  # ç½‘æ ¼åˆ—æ•° (gridå¸ƒå±€)
    gap: str | None                   # ç½‘æ ¼é—´è· (gridå¸ƒå±€)
    panels: list[dict[str, Any]] | None  # æŠ˜å é¢æ¿é…ç½® (accordionå¸ƒå±€)

class Block(BaseModelWithConfig):
    id: str                           # Block ID (å¿…é¡»å”¯ä¸€)
    layout: str                       # Block å¸ƒå±€ç±»å‹: form/grid/tabs/accordion
    title: str | None                 # æ ‡é¢˜
    props: BlockProps | None          # Block å±æ€§
```

**å…³é”®ç‚¹**: 
- Block å¯ä»¥åµŒå¥— Blockï¼ˆé€šè¿‡ `component` å­—æ®µç±»å‹ï¼‰
- Action æ”¯æŒ 4 ç§ç±»å‹ï¼Œä¸åŒç±»å‹æœ‰ä¸åŒé…ç½®

---

#### 8. `backend/fastapi/services/patch.py` - Patch æ“ä½œå¼•æ“

**èŒè´£**: å®ç° 15 ç§ Patch æ“ä½œç±»å‹ï¼Œæ˜¯æ•´ä¸ªç³»ç»Ÿçš„æ ¸å¿ƒ

**æ”¯æŒçš„æ“ä½œ**:
| æ“ä½œç±»å‹ | åŠŸèƒ½ | ç¤ºä¾‹ |
|---------|------|------|
| `set` | è®¾ç½®å€¼ | `{"op": "set", "path": "state.params.name", "value": "å¼ ä¸‰"}` |
| `merge` | åˆå¹¶å¯¹è±¡ | `{"op": "merge", "path": "state.runtime", "value": {"timestamp": "2024-01-01"}}` |
| `add` | æ·»åŠ  Block | `{"op": "add", "path": "blocks", "value": {...block...}}` |
| `remove` | åˆ é™¤ Block | `{"op": "remove", "path": "blocks", "value": {"id": "block1"}}` |
| `append_to_list` | å‘åˆ—è¡¨æ·»åŠ å…ƒç´  | `{"op": "append_to_list", "path": "state.params.users", "value": {...}}` |
| `prepend_to_list` | å‘åˆ—è¡¨å¼€å¤´æ·»åŠ å…ƒç´  | `{"op": "prepend_to_list", "path": "state.params.users", "value": {...}}` |
| `remove_from_list` | ä»åˆ—è¡¨åˆ é™¤å…ƒç´  | `{"op": "remove_from_list", "path": "state.params.users", "value": {"key": "id", "value": 1}}` |
| `remove_last` | åˆ é™¤åˆ—è¡¨æœ€åä¸€é¡¹ | `{"op": "remove_last", "path": "state.params.users"}` |
| `update_list_item` | æ›´æ–°åˆ—è¡¨ä¸­çš„å…ƒç´  | `{"op": "update_list_item", "path": "state.params.users", "value": {"key": "id", "value": 1, "updates": {"name": "æ–°åç§°"}}}` |
| `filter_list` | è¿‡æ»¤åˆ—è¡¨å…ƒç´  | `{"op": "filter_list", "path": "state.params.users", "value": {"key": "status", "value": "active"}}` |
| `increment` | å¢é‡æ›´æ–° | `{"op": "increment", "path": "state.params.counter", "value": 1}` |
| `decrement` | å‡é‡æ›´æ–° | `{"op": "decrement", "path": "state.params.counter", "value": 1}` |
| `toggle` | åˆ‡æ¢å¸ƒå°”å€¼ | `{"op": "toggle", "path": "state.params.visible"}` |
| `clear_all_params` | æ¸…ç©ºæ‰€æœ‰ params | `{"op": "clear_all_params", "path": "state.params"}` |

**æ ¸å¿ƒå‡½æ•°**:
```python
def execute_operation(schema: UISchema, operation: PatchOperationType, params: dict, target_path: str) -> dict:
    """æ‰§è¡Œé€šç”¨æ“ä½œ"""

def apply_patch_to_schema(schema: UISchema, patch: dict) -> None:
    """å°† Patch åº”ç”¨åˆ° Schema"""

def validate_key_uniqueness(schema: UISchema) -> None:
    """éªŒè¯ Block IDã€Field Keyã€Action ID çš„å”¯ä¸€æ€§"""
```

**å…³é”®ç‚¹**:
- `add` æ“ä½œè‡ªåŠ¨åˆå§‹åŒ–æ–°å­—æ®µçš„ `state.params`
- `remove` æ“ä½œè‡ªåŠ¨æ¸…ç†åˆ é™¤å­—æ®µçš„ `state.params`
- æ‰€æœ‰æ“ä½œåè‡ªåŠ¨éªŒè¯å”¯ä¸€æ€§
- æ”¯æŒæ¨¡æ¿å˜é‡æ¸²æŸ“ï¼ˆå¦‚ `${state.params.next_id}`ï¼‰

---

### å‰ç«¯æ ¸å¿ƒæ–‡ä»¶

#### 9. `frontend/src/App.tsx` - åº”ç”¨æ ¹ç»„ä»¶

**èŒè´£**: åº”ç”¨å…¥å£ï¼Œåè°ƒæ‰€æœ‰æ¨¡å—

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
// 1. åŠ è½½ Schema
const { currentInstanceId, schema: initialSchema, loading, error } = useSchema();

// 2. ç®¡ç† Schema Store
const { schema, setSchema, applyPatch, highlightBlock } = useSchemaStore();

// 3. WebSocket æ¥æ”¶å®æ—¶æ›´æ–°
useWebSocket(
  // å¤„ç† Patch
  (patch) => applyPatch(patch, true),
  // å¤„ç†å®ä¾‹åˆ‡æ¢
  (instanceId, schema) => { ... },
  // å¤„ç† Block é«˜äº®
  (blockId) => highlightBlock(blockId)
);

// 4. æ¸²æŸ“ Schema
<SchemaLayoutRenderer
  schema={schema}
  onNavigate={handleInstanceSwitch}
  onNavigateBlock={handleNavigateBlock}
  highlightField={highlightFieldKey}
  highlightBlockId={highlightBlockId}
/>
```

**å…³é”®ç‚¹**:
- å‰ç«¯ä¸ä¸»åŠ¨è®¡ç®—çŠ¶æ€ï¼Œåªè´Ÿè´£æ¸²æŸ“å’Œå‘é€äº‹ä»¶
- æ‰€æœ‰çŠ¶æ€æ›´æ–°é€šè¿‡ WebSocket æ¥æ”¶åç«¯æ¨é€çš„å®Œæ•´ Schema
- ä½¿ç”¨é«˜äº®æœºåˆ¶æç¤ºç”¨æˆ·æ›´æ–°çš„å†…å®¹

---

#### 10. `frontend/src/store/schemaStore.ts` - Schema Store

**èŒè´£**: å”¯ä¸€çœŸæºï¼Œå­˜å‚¨å½“å‰ Schema å’Œå®ä¾‹åˆ—è¡¨

**æ ¸å¿ƒåŠŸèƒ½**:
```typescript
interface SchemaStore {
  schema: UISchema | null;            // å½“å‰ Schema
  instanceId: string | null;          // å½“å‰å®ä¾‹ ID
  highlightBlockId: string | null;    // é«˜äº® Block ID
  highlightFieldKey: string | null;   // é«˜äº®å­—æ®µ Key
  highlightActionId: string | null;    // é«˜äº®æ“ä½œ ID

  setSchema(schema, highlight);       // è®¾ç½® Schema
  setInstanceId(instanceId);           // è®¾ç½®å®ä¾‹ ID
  applyPatch(patch, isExternal);       // åº”ç”¨ Patch
  highlightBlock(blockId);            // é«˜äº® Block
  highlightField(fieldKey);            // é«˜äº®å­—æ®µ
  highlightAction(actionId);           // é«˜äº®æ“ä½œ
}
```

**å…³é”®ç‚¹**:
- ä½¿ç”¨ Zustand + subscribeWithSelector å®ç°ç»†ç²’åº¦è®¢é˜…
- `applyPatch` å‡½æ•°ä¸åç«¯ `apply_patch_to_schema` ä¿æŒé€»è¾‘ä¸€è‡´
- é«˜äº®æœºåˆ¶æŒç»­ 2 ç§’åè‡ªåŠ¨æ¸…é™¤

---

#### 11. `frontend/src/components/GenericFieldRenderer.tsx` - é€šç”¨å­—æ®µæ¸²æŸ“å™¨

**èŒè´£**: æ ¹æ®å­—æ®µç±»å‹åˆ†å‘åˆ°å¯¹åº”çš„æ¸²æŸ“ç»„ä»¶

**å­—æ®µæ¸²æŸ“å™¨æ³¨å†Œè¡¨**:
```typescript
const defaultRenderers: FieldRendererRegistry = {
  text: InputField,
  number: NumberInput,
  textarea: TextArea,
  date: DatePicker,
  datetime: DateTimePicker,
  file: FileUpload,
  checkbox: CheckBox,
  select: Select,
  radio: RadioGroup,
  multiselect: MultiSelect,
  json: JSONViewer,
  html: RichContentRenderer,
  image: ImageRenderer,
  tag: Tag,
  progress: Progress,
  badge: Badge,
  table: Table,
  modal: Modal,
  component: BlockRenderer  // åµŒå¥— Block
};
```

**æ ¸å¿ƒé€»è¾‘**:
```typescript
// 1. ä» schema ä¸­æå–å€¼
const storedValue = useMemo(() => {
  let baseObj: any = schema;
  const bindPathKeys = bindPath.split('.');
  baseObj = bindPathKeys.reduce((obj: any, key: string) => obj?.[key], schema);
  const fieldKeys = field.key.split('.');
  return fieldKeys.reduce((obj: any, key: string) => obj?.[key], baseObj);
}, [schema, bindPath, field.key]);

// 2. ä¹è§‚æ›´æ–°
const handleChange = (newValue: any) => {
  setLocalValue(newValue);                          // ç«‹å³æ›´æ–°æœ¬åœ°çŠ¶æ€
  fieldPatch(bindPath, field.key, newValue);       // åº”ç”¨æœ¬åœ°è¡¥ä¸
  emitFieldChange(field.key, newValue, bindPath);  // å‘é€äº‹ä»¶åˆ°åç«¯
};
```

**å…³é”®ç‚¹**:
- æ”¯æŒåŠ¨æ€æ³¨å†Œæ–°çš„å­—æ®µç±»å‹ (`registerFieldRenderer`)
- ä¹è§‚æ›´æ–°æå‡ç”¨æˆ·ä½“éªŒ
- æ‰€æœ‰å­—æ®µç»„ä»¶æ¥æ”¶ç»Ÿä¸€çš„ Props æ¥å£

---

#### 12. `frontend/src/components/BlockRenderer.tsx` - Block æ¸²æŸ“å™¨

**èŒè´£**: æ ¹æ® Block çš„å¸ƒå±€ç±»å‹æ¸²æŸ“å®¹å™¨å’Œå­—æ®µ

**æ”¯æŒ 4 ç§å¸ƒå±€**:
1. **form**: å‚ç›´æ’åˆ—ï¼Œæ¯ä¸ªå­—æ®µä¸€è¡Œ
2. **grid**: ç½‘æ ¼å¸ƒå±€ï¼Œå¯é…ç½®åˆ—æ•°å’Œé—´è·
3. **tabs**: æ ‡ç­¾é¡µå¸ƒå±€ï¼Œæ¯ä¸ª Tab åŒ…å«ç‹¬ç«‹å­—æ®µ
4. **accordion**: æŠ˜å é¢æ¿å¸ƒå±€ï¼Œæ¯ä¸ª Panel å¯å±•å¼€/æŠ˜å 

**é€’å½’æ¸²æŸ“**: Block å†…çš„ `component` ç±»å‹å­—æ®µå¯ä»¥åµŒå¥—å¦ä¸€ä¸ª Block

---

#### 13. `frontend/src/utils/template.ts` - æ¨¡æ¿å¼•æ“

**èŒè´£**: æ¸²æŸ“æ¨¡æ¿å˜é‡ï¼Œæ”¯æŒ `${state.xxx}` è¯­æ³•

**æ”¯æŒçš„å˜é‡è·¯å¾„**:
```
${state.params.name}          # å­—æ®µå‚æ•°å€¼
${state.runtime.timestamp}     # è¿è¡Œæ—¶æ•°æ®
${params.name}                 # å‚æ•°å¿«æ·è®¿é—®
${runtime.timestamp}            # è¿è¡Œæ—¶å¿«æ·è®¿é—®
${state.params.status.label}    # é€‰é¡¹æ ‡ç­¾
```

**æ ¸å¿ƒå‡½æ•°**:
```typescript
export function renderTemplate(template: string, schema: UISchema): string {
  // åŒ¹é… ${path} æ ¼å¼çš„å ä½ç¬¦
  const pattern = /\$\{([^}]+)\}/g;
  return template.replace(pattern, (match, path) => {
    const value = getNestedValue(schema, path, "");
    return value !== undefined ? String(value) : match;
  });
}
```

**å…³é”®ç‚¹**: æ”¯æŒé€‰é¡¹æ¡†æ ‡ç­¾ï¼ˆå¦‚ `${state.params.status.label}`ï¼‰

---

#### 14. `frontend/src/utils/eventEmitter.ts` - äº‹ä»¶å‘å°„å™¨

**èŒè´£**: ç»Ÿä¸€äº‹ä»¶æµï¼Œå‘é€äº‹ä»¶åˆ°åç«¯

**æ”¯æŒçš„äº‹ä»¶ç±»å‹**:
```typescript
emitFieldChange(fieldKey, value, bindPath);      // å­—æ®µå€¼å˜æ›´
emitActionClick(actionId, patches, ...);        // æ“ä½œæŒ‰é’®ç‚¹å‡»
emitInstanceSwitch(instanceId);                  // å®ä¾‹åˆ‡æ¢
emitBlockNavigate(blockId);                      // Block å¯¼èˆª
```

**å…³é”®ç‚¹**: ä½¿ç”¨é˜²æŠ–æœºåˆ¶ï¼Œé¿å…é¢‘ç¹å‘é€è¯·æ±‚

---

## ğŸ“Š æ•°æ®æ¨¡å‹è¯¦è§£

### æ ¸å¿ƒæ•°æ®ç»“æ„

#### 1. UISchema - UI Schema ç»“æ„

```typescript
{
  "page_key": "demo",              // é¡µé¢é”®
  "state": {
    "params": {                    // å­—æ®µå‚æ•°å€¼
      "counter": 0,
      "message": "æ¬¢è¿",
      "users": [],
      "status": "active"
    },
    "runtime": {                   // è¿è¡Œæ—¶æ•°æ®
      "timestamp": "2024-01-01 12:00:00"
    }
  },
  "layout": {
    "type": "single",             // single | grid | flex | tabs
    "columns": 2,                  // grid å¸ƒå±€åˆ—æ•°
    "gap": "20px"                  // é—´è·
  },
  "blocks": [/* ... */],           // Block åˆ—è¡¨
  "actions": [/* ... */]           // é¡¶å±‚æ“ä½œæŒ‰é’®
}
```

---

#### 2. Block - Block é…ç½®

```typescript
{
  "id": "block1",                  // Block ID (å¿…é¡»å”¯ä¸€)
  "layout": "form",                // form | grid | tabs | accordion
  "title": "è®¡æ•°å™¨",
  "props": {
    "fields": [/* ... */],         // å­—æ®µåˆ—è¡¨
    "actions": [/* ... */],        // Block çº§åˆ«æ“ä½œæŒ‰é’®
    "cols": 2,                     // grid å¸ƒå±€åˆ—æ•°
    "gap": "16px",                 // grid å¸ƒå±€é—´è·
    "tabs": [/* ... */],           // tabs å¸ƒå±€æ ‡ç­¾é¡µé…ç½®
    "panels": [/* ... */]          // accordion å¸ƒå±€é¢æ¿é…ç½®
  }
}
```

---

#### 3. FieldConfig - å­—æ®µé…ç½®

```typescript
// åŸºç¡€å­—æ®µ (text, number, textarea, date, datetime, file, html, json)
{
  "type": "text",
  "key": "name",
  "label": "å§“å",
  "value": "",
  "placeholder": "è¯·è¾“å…¥å§“å",
  "editable": true,
  "required": false,
  "disabled": false
}

// é€‰æ‹©å­—æ®µ (select, radio, multiselect)
{
  "type": "select",
  "key": "status",
  "label": "çŠ¶æ€",
  "options": [
    {"label": "æ´»è·ƒ", "value": "active"},
    {"label": "éæ´»è·ƒ", "value": "inactive"}
  ]
}

// è¡¨æ ¼å­—æ®µ
{
  "type": "table",
  "key": "tasks",
  "columns": [
    {"key": "id", "title": "ID"},
    {"key": "name", "title": "åç§°", "editable": true}
  ],
  "rowKey": "id",
  "tableEditable": true,
  "rowSelection": true
}

// å›¾ç‰‡å­—æ®µ
{
  "type": "image",
  "key": "avatar",
  "label": "å¤´åƒ",
  "imageHeight": "100px",
  "imageFit": "cover"
}
```

---

#### 4. ActionConfig - æ“ä½œé…ç½®

```typescript
// Patch æ“ä½œ
{
  "id": "add",
  "label": "æ·»åŠ ",
  "style": "primary",
  "action_type": "patch",
  "patches": [
    {"op": "append_to_list", "path": "state.params.users", "value": {...}}
  ]
}

// API è°ƒç”¨
{
  "id": "call_api",
  "label": "è°ƒç”¨ API",
  "style": "primary",
  "action_type": "api",
  "api": {
    "url": "https://api.example.com/data",
    "method": "POST",
    "body_template": {"data": "${state.params.request}"},
    "response_mappings": {
      "state.params.response": "json",
      "state.params.status": "status_code"
    }
  }
}

// å®ä¾‹å¯¼èˆª
{
  "id": "to_settings",
  "label": "è®¾ç½®",
  "style": "secondary",
  "action_type": "navigate",
  "target_instance": "settings"
}

// Block å¯¼èˆª
{
  "id": "nav_to_counter",
  "label": "è®¡æ•°å™¨",
  "style": "primary",
  "action_type": "navigate_block",
  "target_block": "counter_block"
}
```

---

#### 5. SchemaPatch - Patch æ“ä½œ

```typescript
{
  "op": "set",                     // æ“ä½œç±»å‹
  "path": "state.params.name",     // ç›®æ ‡è·¯å¾„
  "value": "å¼ ä¸‰"                   // æ–°å€¼ (æŸäº›æ“ä½œä¸éœ€è¦)
}
```

**æ“ä½œç±»å‹**:
- `set`, `merge`: ä¿®æ”¹å€¼
- `add`, `remove`: æ·»åŠ /åˆ é™¤ Block
- `append_to_list`, `prepend_to_list`, `remove_from_list`, `remove_last`, `update_list_item`, `filter_list`: åˆ—è¡¨æ“ä½œ
- `increment`, `decrement`, `toggle`: åŸå­æ“ä½œ
- `clear_all_params`: æ¸…ç©ºå‚æ•°

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- Python 3.8+
- Node.js 16+
- npm æˆ– yarn

### å®‰è£…ä¾èµ–

**åç«¯**:
```bash
cd backend
pip install -r requirements.txt
```

**å‰ç«¯**:
```bash
cd frontend
npm install
```

### å¯åŠ¨æœåŠ¡

**åç«¯** (ç»ˆç«¯ 1):
```bash
cd backend
uvicorn backend.fastapi.main:app --host 0.0.0.0 --port 8001 --reload
```

**å‰ç«¯** (ç»ˆç«¯ 2):
```bash
cd frontend
npm run dev
```

è®¿é—® `http://localhost:5173`

---

## ğŸ”§ å¸¸ç”¨æ“ä½œæŒ‡å—

### 1. åˆ›å»ºæ–°å®ä¾‹

åœ¨ `backend/core/defaults.py` ä¸­æ·»åŠ æ–°å®ä¾‹:

```python
def get_default_instances() -> dict[str, UISchema]:
    return {
        "demo": _create_demo_schema(),
        "my_app": _create_my_app_schema(),  # æ–°å¢
    }

def _create_my_app_schema() -> UISchema:
    return UISchema(
        page_key="my_app",
        state=StateInfo(params={...}),
        layout=LayoutInfo(type="single"),
        blocks=[...],
        actions=[...]
    )
```

---

### 2. æ·»åŠ æ–°å­—æ®µç±»å‹

**åç«¯**:
1. åœ¨ `backend/fastapi/models/enums.py` ä¸­æ·»åŠ æšä¸¾:
```python
class FieldType(str, Enum):
    MY_CUSTOM = "my_custom"  # æ–°å¢
```

2. åœ¨ `backend/fastapi/models/field_models.py` ä¸­æ·»åŠ æ¨¡å‹:
```python
class MyCustomFieldConfig(_BaseFieldConfig):
    type: Literal[FieldType.MY_CUSTOM]
    custom_property: str = "default"
```

**å‰ç«¯**:
1. åœ¨ `frontend/src/types/schema.ts` ä¸­æ·»åŠ ç±»å‹
2. åˆ›å»ºæ¸²æŸ“ç»„ä»¶ `frontend/src/components/MyCustomField.tsx`
3. åœ¨ `GenericFieldRenderer.tsx` ä¸­æ³¨å†Œ:
```typescript
import MyCustomField from './MyCustomField';

const defaultRenderers: FieldRendererRegistry = {
  // ...
  my_custom: MyCustomField
};
```

---

### 3. ä¿®æ”¹ Patch æ“ä½œé€»è¾‘

åœ¨ `backend/fastapi/services/patch.py` ä¸­ä¿®æ”¹ `execute_operation` å‡½æ•°

---

### 4. æ·»åŠ æ–°å¸ƒå±€ç±»å‹

**åç«¯**: åœ¨ `backend/fastapi/models/enums.py` ä¸­æ·»åŠ  `LayoutType` æšä¸¾

**å‰ç«¯**: åœ¨ `BlockRenderer.tsx` ä¸­æ·»åŠ å¯¹åº”çš„å¸ƒå±€æ¸²æŸ“é€»è¾‘

---

## ğŸ› è°ƒè¯•æŠ€å·§

### åç«¯è°ƒè¯•

**æŸ¥çœ‹æ—¥å¿—**:
```bash
# åç«¯æ—¥å¿—åŒ…å«è¯¦ç»†çš„ Patch æ“ä½œä¿¡æ¯
[PatchService] execute_operation: operation=set, path=state.params.name
[SchemaManager] get instance: demo
```

**éªŒè¯ Patch**:
```python
from backend.fastapi.services.patch import validate_key_uniqueness
validate_key_uniqueness(schema)  # éªŒè¯å”¯ä¸€æ€§
```

---

### å‰ç«¯è°ƒè¯•

**æŸ¥çœ‹ Store çŠ¶æ€**:
```javascript
console.log(useSchemaStore.getState());
```

**æŸ¥çœ‹ Schema**:
```javascript
console.log(schema);
```

**æŸ¥çœ‹ Patch**:
```javascript
// åœ¨ applyPatch ä¸­æŸ¥çœ‹ä¼ å…¥çš„ patch
console.log('[SchemaStore] applyPatch å¼€å§‹ï¼Œpatch:', patch);
```

---

## ğŸ“š æ ¸å¿ƒæ¦‚å¿µè§£æ

### å•ä¸€å†™å…¥è·¯å¾„æ¶æ„

**ä¼ ç»Ÿé—®é¢˜**:
- å‰ç«¯ç›´æ¥ä¿®æ”¹çŠ¶æ€ + åç«¯åŒæ­¥ â†’ ç«æ€æ¡ä»¶
- å¤šå¤„å†™å…¥å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´

**æœ¬é¡¹ç›®è§£å†³æ–¹æ¡ˆ**:
```
ç”¨æˆ·æ“ä½œ â†’ å‰ç«¯ä¹è§‚æ›´æ–° â†’ å‘é€äº‹ä»¶ â†’ 
åç«¯è®¡ç®— Patch â†’ WebSocket æ¨é€å®Œæ•´ Schema â†’ 
å‰ç«¯æ›¿æ¢æ•´ä¸ª Schema
```

**ä¼˜åŠ¿**:
- Schema æ˜¯å”¯ä¸€çœŸæº
- é¿å…å‰åç«¯çŠ¶æ€ä¸ä¸€è‡´
- æ”¯æŒè·¨å®¢æˆ·ç«¯å®æ—¶åŒæ­¥

---

### å‰ç«¯è¢«åŠ¨å¼æ›´æ–°

**å®ç°åŸç†**:
- å‰ç«¯å®Œå…¨ä¸ä¸»åŠ¨è®¡ç®—çŠ¶æ€
- æ‰€æœ‰çŠ¶æ€æ›´æ–°ç”±åç«¯æ¨é€çš„ Schema æ›¿æ¢è§¦å‘
- ä½¿ç”¨ Zustand ç®¡ç†å…¨å±€ Schema

**ä¼˜åŠ¿**:
- çŠ¶æ€é€»è¾‘é›†ä¸­åœ¨åç«¯
- å‰ç«¯ç®€åŒ–ä¸ºçº¯æ¸²æŸ“å±‚
- é™ä½å‰ç«¯å¤æ‚åº¦

---

### æ¨¡æ¿å¼•æ“æœåŠ¡ç«¯æ¸²æŸ“

**æ¨¡æ¿è¯­æ³•**:
```
${state.params.name}          # åŸºç¡€å¼•ç”¨
${state.runtime.timestamp}     # è¿è¡Œæ—¶æ•°æ®
${state.params.status.label}   # é€‰é¡¹æ ‡ç­¾
```

**å®ç°ç»†èŠ‚**:
- æœåŠ¡ç«¯ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…å ä½ç¬¦
- æ”¯æŒåµŒå¥—è·¯å¾„
- `append_to_list` ç­‰æ“ä½œçš„ `items` å‚æ•°è‡ªåŠ¨æ¸²æŸ“æ¨¡æ¿

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å”¯ä¸€æ€§çº¦æŸ**:
   - Block çš„ ID å¿…é¡»åœ¨æ‰€æœ‰ Block ä¸­å”¯ä¸€
   - Field çš„ Key å¿…é¡»åœ¨æ‰€æœ‰ Block çš„æ‰€æœ‰ Fields ä¸­å”¯ä¸€
   - Action çš„ ID å¿…é¡»åœ¨æ‰€æœ‰ Block çš„ Actions å’Œ Schema Actions ä¸­å”¯ä¸€

2. **Patch æ“ä½œé¡ºåº**:
   - `add` æ“ä½œåè‡ªåŠ¨åˆå§‹åŒ– `state.params`
   - `remove` æ“ä½œåè‡ªåŠ¨æ¸…ç† `state.params`

3. **WebSocket è¿æ¥**:
   - åç«¯ä¼šå¹¿æ’­ Schema æ›´æ–°ç»™æ‰€æœ‰å®¢æˆ·ç«¯
   - æ”¯æŒé«˜äº®æç¤ºï¼Œæ·»åŠ å­—æ®µ/Action æ—¶è‡ªåŠ¨é«˜äº®

4. **æ¨¡æ¿å˜é‡**:
   - è·¯å¾„åŒºåˆ†å¤§å°å†™
   - å¦‚æœå¼•ç”¨çš„è·¯å¾„ä¸å­˜åœ¨ï¼Œä¼šä¿ç•™åŸå§‹å ä½ç¬¦

---

## ğŸ”— ç›¸å…³æ–‡æ¡£

- [Schema Guide](docs/schema-guide.md) - UI Schema ç»“æ„
- [Tools Reference](docs/tools-reference.md) - MCP å·¥å…·æ–‡æ¡£
- [Field Types](docs/field-types.md) - å­—æ®µç±»å‹è¯¦è§£
- [Template Syntax](docs/template-syntax.md) - æ¨¡æ¿è¯­æ³•
- [Layout Guide](docs/layout-guide.md) - å¸ƒå±€ç³»ç»Ÿ

---

## ğŸ“ æ”¯æŒä¸è”ç³»

å¦‚æœ‰é—®é¢˜ï¼Œè¯·å‚è€ƒä»¥ä¸‹èµ„æºï¼š
- é¡¹ç›® README
- docs/ ç›®å½•ä¸‹çš„è¯¦ç»†æ–‡æ¡£
- ä»£ç æ³¨é‡Š

ç¥å¼€å‘é¡ºåˆ©ï¼
